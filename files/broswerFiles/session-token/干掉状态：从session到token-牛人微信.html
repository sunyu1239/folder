<!DOCTYPE html>
<!-- saved from url=(0061)http://weixin.niurenqushi.com/article/2017-03-20/4794863.html -->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style id="znBdcsStyle" type="text/css">.bdcs-container .bdcs-main,.bdcs-container .bdcs-main *{box-sizing:content-box;margin:0;padding:0;float:none;clear:none;overflow:hidden;white-space:nowrap;word-wrap:normal;border:0;background:0 0;width:auto;height:auto;max-width:none;min-width:none;max-height:none;min-height:none;border-radius:0;box-shadow:none;transition:none;text-align:left}.bdcs-container .bdcs-clearfix:after{content:'';display:block;clear:both;height:0}.bdcs-container .bdcs-clearfix{zoom:1}.bdcs-container .bdcs-main{overflow:visible}.bdcs-container .bdcs-search{display:block;overflow:visible;position:relative;border-style:solid}.bdcs-container .bdcs-search-form-input-wrap{display:inline-block}.bdcs-container .bdcs-search-form-input{border-width:1px;border-style:solid;display:inline-block;vertical-align:top;text-indent:5px;background-color:#fff;float:left}.bdcs-container .bdcs-search-form-input:focus{border-width:1px;border-style:solid;outline:0}.bdcs-container .bdcs-search-form-submit-wrap{display:inline-block}.bdcs-container .bdcs-search-form-submit{display:inline-block;cursor:pointer;border-width:1px;border-style:solid;vertical-align:top;text-align:center;width:50px;//_overflow:hidden}.bdcs-container .bdcs-search-form-submit-magnifier{width:45px;padding:0;text-indent:-999em;overflow:hidden;background:url(http://znsv.baidu.com/static/customer-search/component/search/magnifier-icon.png) no-repeat center center;_background:url(http://znsv.baidu.com/static/customer-search/component/search/magnifier-icon_ie6.png) no-repeat center center}div#default-searchbox .default-channel-meun{position:relative;width:75px;display:inline-block;vertical-align:middle;cursor:pointer;background:#fff;float:left;overflow:visible}div#default-searchbox .default-channel-current{border:1px solid;position:relative;width:100%;border-right:0}div#default-searchbox .default-channel-current span{margin-left:8px}div#default-searchbox .default-channel-current i{overflow:hidden;width:0;height:0;border-width:6px 6px 0;border-color:#9E9E9E #fff;border-style:solid;display:block;position:absolute;right:10px;top:11px}div.cse-default-channel-container{display:block;position:absolute;z-index:30061000000}div.cse-default-channel-container .default-channel-list{display:none;width:99%;list-style:none;background:#fff;border:1px solid #DDD;border-top:0;margin:0;padding:0}div.cse-default-channel-container .default-channel-list li{background:0 0;line-height:24px;list-style:none;display:block;padding-left:7px;cursor:pointer}div.cse-default-channel-container .default-channel-list li:hover{background:#DDD}.bdcs-container .bdcs-search-form-input-wrap{}.bdcs-container .bdcs-search-form-input-notspan{margin-left:0px;font-family:Arial,SimSun,sans-serif;color:#000000;font-size:14px;}.bdcs-container .bdcs-search-form-input .icon-nofocus{left:;right:;top:;height:;width:;}.bdcs-container .bdcs-search{width:299px;height:28px;overflow:hidden;border-color:#dcf7ec;border-radius:0px;border-width:5px;box-shadow:none;background-color:#dcf7ec;}.bdcs-container .bdcs-search-form-input{border-color:#00AAAA;margin-right:0px;width:246px;height:26px;line-height:26px;font-family:Arial,SimSun,sans-serif;color:#000000;font-size:14px;border-radius:0px;background-color:#FFFFFF;}.bdcs-container .bdcs-search-form-input:focus{border-color:#f79646;}.bdcs-container .bdcs-search-form-submit-wrap{}.bdcs-container .bdcs-search-form-submit{border-color:#2e905f;height:26px;width:50px;background-color:#2e905f;color:#ffffff;font-family:Arial,SimSun,sans-serif;font-size:14px;border-radius:0px;}.bdcs-container .bdcs-search-sug-list{width:px;}.bdcs-container .bdcs-search-sug-list-item{height:28px;line-height:28px;font-family:Arial,SimSun,sans-serif;font-size:14px;}.bdcs-container .bdcs-search-sug-list-item-value{color:#000000;}.bdcs-container .bdcs-clearfix:after{content:'';display:block;clear:both;height:0}.bdcs-container .bdcs-clearfix{zoom:1}.bdcs-container .bdcs-search{overflow:visible;position:relative}.bdcs-container .bdcs-search-sug,.bdcs-container .bdcs-search-sug *{box-sizing:content-box;margin:0;padding:0;float:none;clear:none;overflow:hidden;white-space:nowrap;word-wrap:normal;border:0;background:0 0;width:auto;height:auto;max-width:none;min-width:none;max-height:none;min-height:none;border-radius:0;box-shadow:none;transition:none;text-align:left}.bdcs-container .bdcs-search-sug{display:none;position:absolute;z-index:2147483647}.bdcs-container .bdcs-search-sug-list{list-style:none;border:1px solid #DDD;background-color:#FFF}.bdcs-container .bdcs-search-sug-list{}.bdcs-container .bdcs-search-sug-list-item{display:block;list-style:none;cursor:pointer;padding:0 5px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.bdcs-container .bdcs-search-sug-list-item-current{background-color:#EBEBEB}.bdcs-container .bdcs-search-sug-list-item-author-novel,.bdcs-container .bdcs-search-sug-list-item-author-music,.bdcs-container .bdcs-search-sug-list-item-type-movie{color:#BABABA}.bdcs-container .bdcs-search-sug-list-item-author-novel,.bdcs-container .bdcs-search-sug-list-item-author-music{margin-left:5px}.bdcs-container .bdcs-search-sug-list-item-music{overflow:hidden;*zoom:1}.bdcs-container .bdcs-search-sug-list-item-value-movie{float:left}.bdcs-container .bdcs-search-sug-list-item-type-movie{float:right}.bdcs-container .bdcs-search-sug-skin{display:none;width:85px;height:85px;position:absolute;right:1px;bottom:1px}.bdcs-container .bdcs-search-sug-skin-img{width:85px;height:85px}.bdcs-container .bdcs-search-sug-i{color:#e64fa3;font-weight:700;margin-left:10px;font-family:simsun;font-style:normal}.bdcs-container .bdcs-search-sug-adv{width:105px;position:absolute;right:1px;top:1px;display:none}.bdcs-container .bdcs-search-sug-adv-img{position:absolute;top:0;right:0}.bdcs-container{overflow:visible;}.bdcs-container .bdcs-search-form-submit{*height:28px;*margin-top:1px;}.bdcs-container .bdcs-search-form-submit{line-height:26px;}.bdcs-container .bdcs-search-form-input{margin-right:-1px;}.bdcs-container .bdcs-search-sug-list-item{height:28px;line-height:28px;font-family:Arial,SimSun,sans-serif;font-size:14px;}.bdcs-container .bdcs-search-sug-list-item-value{color:#000000;}#bdcs-rec{display:none;}</style><script charset="utf-8" src="./干掉状态：从session到token-牛人微信_files/t.js.下载"></script><script charset="utf-8" src="./干掉状态：从session到token-牛人微信_files/s.js.下载"></script><script type="text/javascript" charset="gbk" id="tanx-s-mm_13293534_3503375_85168297" async="" src="./干掉状态：从session到token-牛人微信_files/ex"></script><script type="text/javascript" charset="gbk" id="tanx-s-mm_13293534_3503375_11467398" async="" src="./干掉状态：从session到token-牛人微信_files/ex(1)"></script>
    
    <title>干掉状态：从session到token-牛人微信</title>
    <link rel="icon" href="http://static.niurenqushi.com/favicon.ico">
    <link type="text/css" rel="stylesheet" href="./干掉状态：从session到token-牛人微信_files/common.css">
    <link rel="stylesheet" type="text/css" href="./干掉状态：从session到token-牛人微信_files/content.css">
    <script type="text/javascript" async="" src="./干掉状态：从session到token-牛人微信_files/js"></script><script src="./干掉状态：从session到token-牛人微信_files/hm.js.下载"></script><script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?911c2542a6a587fc51768abc0006f154";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
        var articleID=4794863;
    </script>
<style>html #hm_t_undefined .hm-t-feedback-trigger {position: fixed;display: block;right: 2px;bottom: 2px;z-index: 99998;cursor: pointer;width: 40px;height: 37px!important;text-align: center;text-decoration: none;white-space: normal;font-size: 14px;line-height: 17px;padding-top: 3px;color: #fff;background: #666;_position: absolute;_top: expression(eval(document.documentElement.scrollTop+(document.documentElement.clientHeight||document.body.clientHeight)-this.offsetHeight-2));}</style><style>html #hm_t_undefined .hm-t-feedback-trigger{_top:expression(eval(document.documentElement.scrollTop+(document.documentElement.clientHeight||document.body.clientHeight)-this.offsetHeight-2-0));}</style></head>
<body><div id="totop" style="display: block;"><a>top</a></div>
<div id="header">
    <div class="header-in">
        <div class="logo-box">
            <a class="logo-link" href="http://weixin.niurenqushi.com/" ga_event="nav_icon">
                <img class="logo" src="./干掉状态：从session到token-牛人微信_files/logo.png" width="128px" height="33px">
            </a>
        </div>
        <div class="nav-top">
            <a href="http://weixin.niurenqushi.com/">微信头条</a>
            <a href="http://weixin.niurenqushi.com/weixin/list.html">公众号大全</a>
            <a href="http://weixin.niurenqushi.com/xcx/list.html">小程序大全</a>
            <a href="http://www.niurenqushi.com/">牛人趣事</a>
            <span class="search_box">
                <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=3519123244655018694' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script><div id="bdcs"><div class="bdcs-container"><meta http-equiv="x-ua-compatible" content="IE=9">   <!-- 嵌入式 -->  <div class="bdcs-main bdcs-clearfix" id="default-searchbox">      <div class="bdcs-search bdcs-clearfix" id="bdcs-search-inline">          <form action="http://s.weixin.niurenqushi.com/cse/search" method="get" target="_blank" class="bdcs-search-form" autocomplete="off" id="bdcs-search-form">              <input type="hidden" name="s" value="3519123244655018694">              <input type="hidden" name="entry" value="1">                                                                        <input type="text" name="q" class="bdcs-search-form-input" id="bdcs-search-form-input" placeholder="可搜索公众号或文章" autocomplete="off" style="height: 26px; line-height: 26px;">              <input type="submit" class="bdcs-search-form-submit " id="bdcs-search-form-submit" value="搜索">                       </form>      </div>                <div class="bdcs-search-sug" id="bdcs-search-sug" style="top: 43px; left: 894px; width: 247px;">              <ul class="bdcs-search-sug-list" id="bdcs-search-sug-list"></ul>          </div>                  </div>                           </div></div>
            </span>
        </div>
    </div>
</div>
    <!--内容 begin-->
    <div class="content">
        <div class="conleft">
            <div class="line_nav">
                <a href="http://weixin.niurenqushi.com/">首页</a><span>&gt;</span>
                <a href="http://weixin.niurenqushi.com/article/list-1.html">教育</a><span>&gt;</span>
                干掉状态：从session到token
            </div>
            <div class="contitle">
                <h1>干掉状态：从session到token</h1>
                <div>
                    2017-03-20 08:30&nbsp;&nbsp;&nbsp;&nbsp;
                    <a class="ly" href="http://weixin.niurenqushi.com/article/list-1.html">教育</a>&nbsp;&nbsp;&nbsp;&nbsp;
                    来自：<a class="ly" href="http://weixin.niurenqushi.com/wxshow/niurenqushi.html">牛人趣事</a>
                </div>
            </div>
            <div class="concontent">
                <div id="contentbody"><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="padding: 2px; display: inline-block; background-color: rgb(0, 0, 0); box-sizing: border-box;"><section class="" style="padding-right: 8px; padding-left: 8px; margin-right: 5px; display: inline-block; background-color: rgb(95, 156, 239); color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">1</p></section><section class="" style="padding-right: 5px; padding-left: 5px; display: inline-block; color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">美好的旧时光</p></section></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;">我经常怀念三十年前那美好的旧时光， 工作很轻松， 生活很悠闲。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">上班的时候偶尔有些HTTP的请求发到我这里， 我简单的看一下， 取出相对应的html文档，图片，发回去就可以了， 然后就可以继续喝茶聊天。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">我的创造者们对我很好， 他们制定的一个简单HTTP协议， 就是请求加响应， &nbsp;尤其是我不用记住是谁刚刚发了HTTP请求， &nbsp; 每个请求对我来说都是全新的！</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">邮件服务器很羡慕我， 他说：老弟，你的生活太惬意了， &nbsp;哪像我， 每次有人从客户端访问邮箱， 我都得专门给他建立一个会话， 来处理他发的消息， 你倒好， 完全不用管理会话。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">这是由应用的特性决定的， 如果邮件服务器不管理会话， 那多个人之间的邮件消息就会完全混到一起了， 乱作一团了。</p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">而30年前的Web 基本上就是文档的浏览而已， 既然是浏览，我作为一个服务器， 为什么要记住谁在一段时间里都浏览了什么文档呢？</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="padding: 2px; display: inline-block; background-color: rgb(0, 0, 0); box-sizing: border-box;"><section class="" style="padding-right: 8px; padding-left: 8px; margin-right: 5px; display: inline-block; background-color: rgb(95, 156, 239); color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">2</p></section><section class="" style="padding-right: 5px; padding-left: 5px; display: inline-block; color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">Session</p></section></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">但是好日子没持续多久， 很快大家就不满足于静态的Html 文档了， 交互式的Web应用开始兴起， 尤其是论坛， 在线购物等网站。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">我马上就遇到了和邮件服务器一样的问题， 那就是必须管理会话，必须记住哪些人登录系统， &nbsp;哪些人往自己的购物车中放了商品， &nbsp;也就是说我必须把每个人区分开。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">这对我来说是个不小的挑战， 由于HTTP协议的无状态特性， 我必须加点小手段，才能完成会话管理。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">我想出的办法就是给大家发一个会话标识(session id), 说白了就是一个随机的字符串，每个人收到的都不一样， &nbsp;每次大家向我发起HTTP请求的时候，把这个字符串给一并捎过来， 这样我就能区分开谁是谁了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="padding: 2px; display: inline-block; background-color: rgb(0, 0, 0); box-sizing: border-box;"><section class="" style="padding-right: 8px; padding-left: 8px; margin-right: 5px; display: inline-block; background-color: rgb(95, 156, 239); color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">3</p></section><section class="" style="padding-right: 5px; padding-left: 5px; display: inline-block; color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">沉重的负担</p></section></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;">大家都很高兴， 可是我就不爽了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">每个人只需要保存自己的session id，而我需要保存所有人的session id ！ &nbsp;如果访问我的人多了， 就得由成千上万，甚至几十万个。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">这对我来说是一个巨大的开销 ， 严重的限制了我的扩展能力， 比如说我用两个机器组成了一个集群， 小F通过机器A登录了系统， &nbsp;那session id会保存在机器A上， &nbsp;假设小F的下一次请求被转发到机器B怎么办？ &nbsp;机器B可没有小F的 session id啊。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">有时候我会采用一点小伎俩： session sticky ， 就是让小F的请求一直粘连在机器A上， 但是这也不管用， 要是机器A挂掉了， 还得转到机器B去。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">那我只好做session 的复制了， 把session id &nbsp;在两个机器之间搬来搬去， 快累死了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" text-align: center; margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><img style="vertical-align: middle; box-sizing: border-box;" class="" src="./干掉状态：从session到token-牛人微信_files/0" data-ratio="0.6411378555798687" data-w="457" data-type="png"></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;">后来有个叫Memcached的给我支了招： 把session id 集中存储到一个地方， 所有的机器都来访问这个地方的数据， 这样一来，就不用复制了， 但是增加了单点失败的可能性， 要是那个负责session 的机器挂了， &nbsp;所有人都得重新登录一遍， 估计得被人骂死。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px; transform: translate3d(0px, 0px, 0px); -webkit-transform: translate3d(0px, 0px, 0px); -moz-transform: translate3d(0px, 0px, 0px); -o-transform: translate3d(0px, 0px, 0px);  box-sizing: border-box; "><img style="vertical-align: middle; box-sizing: border-box;" class="" src="./干掉状态：从session到token-牛人微信_files/0(1)" data-ratio="0.8271334792122538" data-w="457" data-type="png"></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;">我也尝试把这个单点的机器也搞出集群，增加可靠性， 但不管如何， 这小小的session 对我来说是一个沉重的负担。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="padding: 2px; display: inline-block; background-color: rgb(0, 0, 0); box-sizing: border-box;"><section class="" style="padding-right: 8px; padding-left: 8px; margin-right: 5px; display: inline-block; background-color: rgb(95, 156, 239); color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">4</p></section><section class="" style="padding-right: 5px; padding-left: 5px; display: inline-block; color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">时间换空间</p></section></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;">这几天的晚上我一直在思考， 我为什么要保存这可恶的session呢， 只让每个客户端去保存该多好？</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">可是如果我不保存这些session id , &nbsp;我怎么验证客户端发给我的session id 的确是我生成的呢？ &nbsp;如果我不去验证，我都不知道他们是不是合法登录的用户， 那些不怀好意的家伙们就可以伪造session id , 为所欲为了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">嗯，对了，关键点就是验证 ！</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">比如说， 小F已经登录了系统， 我给他发一个令牌(token)， 里边包含了小F的 user id， 下一次小F 再次通过Http 请求访问我的时候， 把这个token 通过Http header 带过来不就可以了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">不过这和session id没有本质区别啊， 任何人都可以可以伪造， &nbsp;所以我得想点儿办法， 让别人伪造不了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">那就对数据做一个签名吧， 比如说我用HMAC-SHA256 算法，加上一个只有我才知道的密钥， &nbsp;对数据做一个签名， 把这个签名和数据一起作为token ， &nbsp; 由于密钥别人不知道， 就无法伪造token了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px; transform: translate3d(0px, 0px, 0px); -webkit-transform: translate3d(0px, 0px, 0px); -moz-transform: translate3d(0px, 0px, 0px); -o-transform: translate3d(0px, 0px, 0px);  box-sizing: border-box; "><img style="vertical-align: middle; box-sizing: border-box;" class="" src="./干掉状态：从session到token-牛人微信_files/0(2)" data-ratio="1.033033033033033" data-w="333" data-type="png"></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;">这个token 我不保存， &nbsp;当小F把这个token 给我发过来的时候，我再用同样的HMAC-SHA256 算法和同样的密钥，对数据再计算一次签名， 和token 中的签名做个比较， 如果相同， 我就知道小F已经登录过了，并且可以直接取到小F的user id , &nbsp;如果不相同， 数据部分肯定被人篡改过， 我就告诉发送者： 对不起，没有认证。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" text-align: center; margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><img style="vertical-align: middle; box-sizing: border-box;" class="" src="./干掉状态：从session到token-牛人微信_files/0(3)" data-ratio="0.8132387706855791" data-w="423" data-type="png"></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;">Token 中的数据是明文保存的（虽然我会用Base64做下编码， 但那不是加密）， 还是可以被别人看到的， 所以我不能在其中保存像密码这样的敏感信息。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">当然， 如果一个人的token 被别人偷走了， 那我也没办法， 我也会认为小偷就是合法用户， 这其实和一个人的session id 被别人偷走是一样的。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">这样一来， 我就不保存session id 了， 我只是生成token , 然后验证token ， &nbsp;我用我的CPU计算时间获取了我的session 存储空间 ！</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">解除了session id这个负担， &nbsp;可以说是无事一身轻， 我的机器集群现在可以轻松地做水平扩展， 用户访问量增大， 直接加机器就行。 &nbsp; 这种无状态的感觉实在是太好了！</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">（完）</p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;"><span style="background-color: rgb(255, 255, 255);">你看到的只是冰山一角， 更多精彩文章，参见《</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxOTc0NzExNg==&amp;mid=2665513504&amp;idx=1&amp;sn=25dd6420e3056101dd3f6fdaedacaa2a&amp;chksm=80d67a63b7a1f37572a5159ff6f53810467c15c8beec94770e8360c45f45036360d77755ee78&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://pics.niurenqushi.com/copy/mp.weixin.qq.com/s?__biz=MzAxOTc0NzExNg==&amp;mid=2665513504&amp;idx=1&amp;sn=25dd6420e3056101dd3f6fdaedacaa2a&amp;chksm=80d67a63b7a1f37572a5159ff6f53810467c15c8beec94770e8360c45f45036360d77755ee78&amp;scene=21#wechat_redirect" style="color: rgb(0, 82, 255); white-space: normal; font-size: 18px;"><strong>码农翻身文章精华</strong></a><span style="background-color: rgb(255, 255, 255);">》</span></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">有心得想和大家分享？ 欢迎投稿 ！ 我的联系方式：微信：liuxinlehan &nbsp;QQ: 3340792577</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class=" __bg_gif" style="display: inline-block; vertical-align: top; width: 35%; background-image: url(" http:="" background-position:="" background-repeat:="" no-repeat="" background-size:="" background-attachment:="" scroll="" box-sizing:="" border-box=""><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" text-align: center; margin: 15px 0%;  box-sizing: border-box; "><img style="vertical-align: middle; width: 80%; box-sizing: border-box;" class="" src="./干掉状态：从session到token-牛人微信_files/0(4)" data-ratio="1" data-w="258" width="80%" data-type="jpeg"></section></section></section><section class="" style="display: inline-block; vertical-align: top; width: 65%; box-sizing: border-box;"><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin: 20px 0% 8px; font-size: 12.8px;  box-sizing: border-box; "><section class="" style="display: inline-block; height: 2em; padding: 0.3em 0.5em; vertical-align: top; background-color: rgb(95, 156, 239); color: rgb(255, 255, 255); box-sizing: border-box;"><p style="box-sizing: border-box;">公众号：码农翻身</p></section><section class="" style="width: 0.5em; display: inline-block; height: 2em; vertical-align: top; border-bottom: 1em solid rgb(95, 156, 239); border-top: 1em solid rgb(95, 156, 239); border-right: 1em solid transparent !important; box-sizing: border-box;"><p></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="font-size: 14px; padding-right: 5px; padding-left: 5px; box-sizing: border-box;"><p style="box-sizing: border-box;">“码农翻身”公众号由工作15年的前IBM架构师创建，分享编程和职场的经验教训。</p></section></section></section></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 0.5em; margin-bottom: 0.5em;  box-sizing: border-box; "><section style="border-top: 1px dashed rgb(95, 156, 239); box-sizing: border-box;" class=""><p></p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="text-align: center; box-sizing: border-box;"><span style="font-size: 18px; box-sizing: border-box;"><strong style="box-sizing: border-box;"><br style="box-sizing: border-box;"></strong></span></p><p style="text-align: center; box-sizing: border-box;"><span style="font-size: 18px; box-sizing: border-box;"><strong style="box-sizing: border-box;">编辑推荐</strong></span></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">掘金是一个高质量的技术社区，从移动开发到架构设计，编程语言到开源类库，让你不错过互联网开发的每一个技术干货。长按图片二维码识别或者各大应用市场搜索「掘金」，技术干货尽在掌握中。</p></section></section></section><section class="Powered-by-XIUMI V5" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" text-align: center; margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><img style="vertical-align: middle; box-sizing: border-box;" class="" src="./干掉状态：从session到token-牛人微信_files/0(5)" data-ratio="0.55625" data-w="640" data-type="png"></section></section></section><p><br></p></div>
                <div class="hold10px"></div>
            </div>
        </div>
        <!--右侧 begin-->
        <div class="aside right">
    <!--<script type="text/javascript">
        /*微信大全-PC端-右上角方块广告-300*250 创建于 2016-05-17*/
        var cpro_id = "u2642687";
    </script>
    <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>  -->
    <!--实时要闻 begin-->
    <div class="ssyw">
        <div class="ssyw-b"><em></em><h2>最新收录</h2></div>
        <div class="ssyw-n">
<input type="hidden" class="get_article_list" varname="artlist" categoryid="0" channelid="0" orderid="0" ispic="0" getcount="5" orderby="ArticleID">
            <ul>
                <li><a href="http://weixin.niurenqushi.com/article/2017-11-18/5037770.html" target="_blank">【通源雷克萨斯●品牌】全新雷克萨斯RX 350L三排座将于2017洛杉矶车展全球首发</a></li>
                
                <li><a href="http://weixin.niurenqushi.com/article/2017-11-18/5037769.html" target="_blank">【刚刚】权威发布：尾号1和6的车主注意！西安周一起确定常态化限行！</a></li>
                
                <li><a href="http://weixin.niurenqushi.com/article/2017-11-18/5037768.html" target="_blank">身高1米55、1米68、1米72的女生，在男生眼里区别居然这么大！看完有点小庆幸呢</a></li>
                
                <li><a href="http://weixin.niurenqushi.com/article/2017-11-18/5037767.html" target="_blank">5元硬币来了！12月13日发行，黑龙江分到1070万枚！到哪儿预约？防伪特征是啥？</a></li>
                
                <li><a href="http://weixin.niurenqushi.com/article/2017-11-18/5037766.html" target="_blank">“几乎所有生命，都被烧焦而死。” 这7万人瞬间死亡或拯救了日本！</a></li>
                
            </ul>
        </div>
    </div>
    <!--实时要闻 end-->
<div>
<script type="text/javascript">
        document.write('<a style="display:none!important" id="tanx-a-mm_13293534_3503375_11467398"></a>');
        tanx_s = document.createElement("script");
        tanx_s.type = "text/javascript";
        tanx_s.charset = "gbk";
        tanx_s.id = "tanx-s-mm_13293534_3503375_11467398";
        tanx_s.async = true;
        tanx_s.src = "http://p.tanx.com/ex?i=mm_13293534_3503375_11467398";
        tanx_h = document.getElementsByTagName("head")[0];
        if(tanx_h)tanx_h.insertBefore(tanx_s,tanx_h.firstChild);
</script><a style="display:none!important" id="tanx-a-mm_13293534_3503375_11467398"></a>
    </div>
  <!--猜你喜欢 begin-->
    <div class="hold10px"></div>
    <div id="hm_t_55371"></div>
    <div class="hold10px"></div>
    <!--猜你喜欢 end-->
<!--实时要闻 begin-->
    <div class="ssyw">
        <div class="ssyw-b"><em></em><h2>点击排行</h2></div>
        <div class="ssyw-n">
<input type="hidden" class="get_article_list" varname="artlisttop" categoryid="0" channelid="0" orderid="0" ispic="0" getcount="5" orderby="ViewCount">
            <ul>
                <li><a href="http://weixin.niurenqushi.com/article/2017-04-07/4815852.html" target="_blank">【印象·长安】工大夜骑ver.4.0！在北京的春夜相约一场低碳环保的约会吧！(252811)</a></li>
                
                <li><a href="http://weixin.niurenqushi.com/article/2016-03-23/4200507.html" target="_blank">李沁为什么不待见魏大勋，因为她的前任们都是高颜值啊！(154369)</a></li>
                
                <li><a href="http://weixin.niurenqushi.com/article/2016-06-20/4331585.html" target="_blank">对不起，这是橘猫被黑得最惨的一次。(80773)</a></li>
                
                <li><a href="http://weixin.niurenqushi.com/article/2015-03-22/2418930.html" target="_blank">令完成掌握「政治核弹」中共高层淫乱视频(77020)</a></li>
                
                <li><a href="http://weixin.niurenqushi.com/article/2015-04-26/3484469.html" target="_blank">一个冰妹的溜冰之后....,太恐怖!【千万不要碰毒品】(74612)</a></li>
                
            </ul>
        </div>
    </div>
    <!--实时要闻 end-->
<!--
    <script type="text/javascript">
        /*微信大全-PC端-右侧-悬停-300*250 创建于 2016-05-17*/
        var cpro_id = "u2642694";
    </script>
    <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>-->
    <!--foot begin-->
    <div class="foot">
        <div class="foot-box">
            <div class="copylink">
                <p>© 2016 牛人趣事 niurenqushi.com</p><br>
                <p>
                    网站备案号：<a target="_blank" rel="nofollow" href="http://www.miibeian.gov.cn/">粤ICP备13003832号</a>
                </p><br>
                <p>声明：本站所有新闻及新闻图片来源于其他网站，如有侵权，请及时联系我们！<font color="red">联系QQ:2250785074</font></p>
            </div>
        </div>
    </div>
    <!--foot end-->

</div>
        <script type="text/javascript" src="./干掉状态：从session到token-牛人微信_files/jquery.min.js.下载"></script>
<script type="text/javascript" src="./干掉状态：从session到token-牛人微信_files/manhuatoTop.1.0.js.下载" charset="utf-8"></script>
<script type="text/javascript" src="./干掉状态：从session到token-牛人微信_files/client_article_show.js.下载"></script>
        <!--右侧 end-->
    </div>
    <!--内容 end-->
<script type="text/javascript">
    document.write('<a style="display:none!important" id="tanx-a-mm_13293534_3503375_85168297"></a>');
    tanx_s = document.createElement("script");
    tanx_s.type = "text/javascript";
    tanx_s.charset = "gbk";
    tanx_s.id = "tanx-s-mm_13293534_3503375_85168297";
    tanx_s.async = true;
    tanx_s.src = "http://p.tanx.com/ex?i=mm_13293534_3503375_85168297";
    tanx_h = document.getElementsByTagName("head")[0];
    if(tanx_h)tanx_h.insertBefore(tanx_s,tanx_h.firstChild);
</script><a style="display:none!important" id="tanx-a-mm_13293534_3503375_85168297"></a>
<script type="text/javascript" src="./干掉状态：从session到token-牛人微信_files/detectmobilebrowser.js.下载"></script>

<div id="hm_t_undefined" class="hm-t-container"><div class="hm-t-feedback-trigger hm-t-unfold-button hm-t-unfold-button-txt" title="反馈建议" style="bottom: 2px; font-size: 14px; line-height: 17px; padding-top: 3px; height: 37px;">反馈建议</div></div></body></html>